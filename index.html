<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSRS Herblore Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #dee2e6;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2196F3;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .results-table th {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            font-weight: 600;
        }

        .results-table tr:hover {
            background-color: #f5f5f5;
        }

        .profit {
            color: #4CAF50;
            font-weight: bold;
        }

        .loss {
            color: #f44336;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ§ª OSRS Herblore Calculator</h1>
            <p>Calculate XP, costs, and profits from grimy herbs to finished potions</p>
        </div>

        <div class="card">
            <h2>Player Information</h2>
            <div class="form-group">
                <label for="username">OSRS Username:</label>
                <input type="text" id="username" placeholder="Enter your OSRS username">
            </div>
            <div class="form-group">
                <label for="targetLevel">Target Level:</label>
                <input type="number" id="targetLevel" min="1" max="99" placeholder="Enter target herblore level">
            </div>
            <button class="btn" onclick="loadPlayerStats()">Load Player Stats</button>
        </div>

        <div id="playerStats" class="card" style="display: none;">
            <h2>Current Stats</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="currentLevel">-</div>
                    <div class="stat-label">Current Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentXP">-</div>
                    <div class="stat-label">Current XP</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="targetXP">-</div>
                    <div class="stat-label">Target XP</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="xpNeeded">-</div>
                    <div class="stat-label">XP Needed</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Potion Selection</h2>
            <div class="form-group">
                <label for="potionType">Select Potion:</label>
                <select id="potionType">
                    <option value="">Choose a potion...</option>
                    <option value="attack">Attack Potion</option>
                    <option value="antipoison">Antipoison</option>
                    <option value="strength">Strength Potion</option>
                    <option value="serum_207">Serum 207</option>
                    <option value="relicyms_balm">Relicym's Balm</option>
                    <option value="restore">Restore Potion</option>
                    <option value="energy">Energy Potion</option>
                    <option value="defence">Defence Potion</option>
                    <option value="agility">Agility Potion</option>
                    <option value="combat">Combat Potion</option>
                    <option value="prayer">Prayer Potion</option>
                    <option value="super_attack">Super Attack</option>
                    <option value="super_antipoison">Super Antipoison</option>
                    <option value="fishing">Fishing Potion</option>
                    <option value="super_energy">Super Energy</option>
                    <option value="super_strength">Super Strength</option>
                    <option value="super_restore">Super Restore</option>
                    <option value="super_defence">Super Defence</option>
                    <option value="antifire">Antifire Potion</option>
                    <option value="ranging">Ranging Potion</option>
                    <option value="magic">Magic Potion</option>
                    <option value="stamina">Stamina Potion</option>
                    <option value="extended_antifire">Extended Antifire</option>
                    <option value="antivenom">Antivenom</option>
                    <option value="super_combat">Super Combat Potion</option>
                    <option value="antivenom_plus">Antivenom+</option>
                    <option value="extended_super_antifire">Extended Super Antifire</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="useLivePrices"> Use Live GE Prices
                </label>
            </div>
            <button class="btn" onclick="calculatePotion()">Calculate</button>
            <button class="btn btn-secondary" onclick="loadLivePrices()">Update Live Prices</button>
        </div>

        <div id="results" class="card" style="display: none;">
            <h2>Calculation Results</h2>
            <div id="resultContent"></div>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        // Potion data with XP values, levels, and ingredient info
        const potionData = {
            attack: { level: 3, xp: 25, herb: 'guam', secondary: 'eye_of_newt', name: 'Attack Potion' },
            antipoison: { level: 5, xp: 37.5, herb: 'marrentill', secondary: 'unicorn_horn_dust', name: 'Antipoison' },
            strength: { level: 12, xp: 50, herb: 'tarromin', secondary: 'limpwurt_root', name: 'Strength Potion' },
            serum_207: { level: 15, xp: 50, herb: 'tarromin', secondary: 'ashes', name: 'Serum 207' },
            relicyms_balm: { level: 8, xp: 40, herb: 'rogue_purse', secondary: 'snake_weed', name: "Relicym's Balm" },
            restore: { level: 22, xp: 62.5, herb: 'harralander', secondary: 'red_spiders_eggs', name: 'Restore Potion' },
            energy: { level: 26, xp: 67.5, herb: 'harralander', secondary: 'chocolate_dust', name: 'Energy Potion' },
            defence: { level: 30, xp: 75, herb: 'ranarr', secondary: 'white_berries', name: 'Defence Potion' },
            agility: { level: 34, xp: 80, herb: 'toadflax', secondary: 'toad_legs', name: 'Agility Potion' },
            combat: { level: 36, xp: 84, herb: 'harralander', secondary: 'goat_horn_dust', name: 'Combat Potion' },
            prayer: { level: 38, xp: 87.5, herb: 'ranarr', secondary: 'snape_grass', name: 'Prayer Potion' },
            super_attack: { level: 45, xp: 100, herb: 'irit', secondary: 'eye_of_newt', name: 'Super Attack' },
            super_antipoison: { level: 48, xp: 106.3, herb: 'irit', secondary: 'unicorn_horn_dust', name: 'Super Antipoison' },
            fishing: { level: 50, xp: 112.5, herb: 'avantoe', secondary: 'snape_grass', name: 'Fishing Potion' },
            super_energy: { level: 52, xp: 117.5, herb: 'avantoe', secondary: 'mort_myre_fungus', name: 'Super Energy' },
            super_strength: { level: 55, xp: 125, herb: 'kwuarm', secondary: 'limpwurt_root', name: 'Super Strength' },
            super_restore: { level: 63, xp: 142.5, herb: 'snapdragon', secondary: 'red_spiders_eggs', name: 'Super Restore' },
            super_defence: { level: 66, xp: 150, herb: 'cadantine', secondary: 'white_berries', name: 'Super Defence' },
            antifire: { level: 69, xp: 157.5, herb: 'lantadyme', secondary: 'dragon_scale_dust', name: 'Antifire Potion' },
            ranging: { level: 72, xp: 162.5, herb: 'dwarf_weed', secondary: 'wine_of_zamorak', name: 'Ranging Potion' },
            magic: { level: 76, xp: 172.5, herb: 'lantadyme', secondary: 'potato_cactus', name: 'Magic Potion' },
            stamina: { level: 77, xp: 25.5, herb: 'super_energy', secondary: 'amylase_crystal', name: 'Stamina Potion' },
            extended_antifire: { level: 84, xp: 110, herb: 'antifire', secondary: 'lava_scale_shard', name: 'Extended Antifire' },
            antivenom: { level: 87, xp: 120, herb: 'antidote_plus_plus', secondary: 'zulrah_scale', name: 'Antivenom' },
            super_combat: { level: 90, xp: 150, herb: 'torstol', secondary: 'barbarian_herblore', name: 'Super Combat Potion' },
            antivenom_plus: { level: 94, xp: 125, herb: 'antivenom', secondary: 'magic_fang', name: 'Antivenom+' },
            extended_super_antifire: { level: 98, xp: 160, herb: 'extended_antifire', secondary: 'crushed_superior_dragon_bones', name: 'Extended Super Antifire' }
        };

        // Sample prices (these would normally come from GE API)
        let currentPrices = {
            // Herbs
            guam: 15, marrentill: 25, tarromin: 35, harralander: 50, ranarr: 7500, toadflax: 2500,
            irit: 800, avantoe: 1500, kwuarm: 1200, snapdragon: 9000, cadantine: 1300, lantadyme: 1400,
            dwarf_weed: 1800, torstol: 25000,
            // Secondaries
            eye_of_newt: 3, unicorn_horn_dust: 600, limpwurt_root: 800, ashes: 20, snake_weed: 15,
            red_spiders_eggs: 250, chocolate_dust: 50, white_berries: 15, toad_legs: 200, goat_horn_dust: 100,
            snape_grass: 15, mort_myre_fungus: 400, dragon_scale_dust: 200, wine_of_zamorak: 1500,
            potato_cactus: 800, amylase_crystal: 1200, lava_scale_shard: 15000, zulrah_scale: 200,
            magic_fang: 5000000, crushed_superior_dragon_bones: 50000,
            // Vials
            vial_of_water: 5,
            // Finished potions (3-dose)
            attack_potion: 50, antipoison_potion: 100, strength_potion: 120, serum_207_potion: 80,
            relicyms_balm_potion: 90, restore_potion: 200, energy_potion: 150, defence_potion: 500,
            agility_potion: 300, combat_potion: 180, prayer_potion: 8500, super_attack_potion: 900,
            super_antipoison_potion: 1100, fishing_potion: 1800, super_energy_potion: 2200,
            super_strength_potion: 2000, super_restore_potion: 10000, super_defence_potion: 2500,
            antifire_potion: 3000, ranging_potion: 4000, magic_potion: 3500, stamina_potion: 2500,
            extended_antifire_potion: 8000, antivenom_potion: 12000, super_combat_potion: 15000,
            antivenom_plus_potion: 25000, extended_super_antifire_potion: 45000
        };

        // XP table for levels 1-99
        const xpTable = [0, 0, 83, 174, 276, 388, 512, 650, 801, 969, 1154, 1358, 1584, 1833, 2107, 2411, 2746, 3115, 3523, 3973, 4470, 5018, 5624, 6291, 7028, 7842, 8740, 9730, 10824, 12031, 13363, 14833, 16456, 18247, 20224, 22406, 24815, 27473, 30408, 33648, 37224, 41171, 45529, 50339, 55649, 61512, 67983, 75127, 83014, 91721, 101333, 111945, 123660, 136594, 150872, 166636, 184040, 203254, 224466, 247886, 273742, 302288, 333804, 368599, 407015, 449428, 496254, 547953, 605032, 668051, 737627, 814445, 899257, 992895, 1096278, 1210421, 1336443, 1475581, 1629200, 1798808, 1986068, 2192818, 2421087, 2673114, 2951373, 3258594, 3597792, 3972294, 4385776, 4842295, 5346332, 5902831, 6517253, 7195629, 7944614, 8771558, 9684577, 10692629, 11805606, 13034431];

        let playerData = null;

        function showMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error' : 'success';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messagesDiv.removeChild(messageDiv);
            }, 5000);
        }

        function getLevelFromXP(xp) {
            for (let i = xpTable.length - 1; i >= 0; i--) {
                if (xp >= xpTable[i]) {
                    return i;
                }
            }
            return 1;
        }

        function getXPForLevel(level) {
            return xpTable[level] || 0;
        }

        async function loadPlayerStats() {
            const username = document.getElementById('username').value.trim();
            const targetLevel = parseInt(document.getElementById('targetLevel').value);
            
            if (!username) {
                showMessage('Please enter a username', 'error');
                return;
            }
            
            if (!targetLevel || targetLevel < 1 || targetLevel > 99) {
                showMessage('Please enter a valid target level (1-99)', 'error');
                return;
            }

            try {
                showMessage('Loading player stats...');
                
                // Try to fetch from OSRS API
                const response = await fetch(`https://secure.runescape.com/m=hiscore_oldschool/index_lite.ws?player=${encodeURIComponent(username)}`);
                
                if (!response.ok) {
                    throw new Error('Player not found or API unavailable');
                }
                
                const data = await response.text();
                const lines = data.split('\n');
                
                // Herblore is skill index 15
                const herbloreData = lines[15].split(',');
                const level = parseInt(herbloreData[1]);
                const xp = parseInt(herbloreData[2]);
                
                playerData = {
                    username: username,
                    currentLevel: level,
                    currentXP: xp,
                    targetLevel: targetLevel,
                    targetXP: getXPForLevel(targetLevel),
                    xpNeeded: getXPForLevel(targetLevel) - xp
                };
                
                displayPlayerStats();
                showMessage('Player stats loaded successfully!');
                
            } catch (error) {
                // If API fails, allow manual entry
                playerData = {
                    username: username,
                    currentLevel: 1,
                    currentXP: 0,
                    targetLevel: targetLevel,
                    targetXP: getXPForLevel(targetLevel),
                    xpNeeded: getXPForLevel(targetLevel)
                };
                
                displayPlayerStats();
                showMessage('Could not load stats from API. Using default values. You can manually adjust if needed.', 'error');
            }
        }

        function displayPlayerStats() {
            document.getElementById('currentLevel').textContent = playerData.currentLevel;
            document.getElementById('currentXP').textContent = playerData.currentXP.toLocaleString();
            document.getElementById('targetXP').textContent = playerData.targetXP.toLocaleString();
            document.getElementById('xpNeeded').textContent = Math.max(0, playerData.xpNeeded).toLocaleString();
            
            document.getElementById('playerStats').style.display = 'block';
        }

        async function loadLivePrices() {
            try {
                showMessage('Loading live prices...');
                
                // In a real implementation, you would fetch from the OSRS GE API
                // For now, we'll simulate with some price variations
                const priceVariations = [0.8, 0.9, 1.0, 1.1, 1.2];
                
                Object.keys(currentPrices).forEach(item => {
                    const variation = priceVariations[Math.floor(Math.random() * priceVariations.length)];
                    currentPrices[item] = Math.floor(currentPrices[item] * variation);
                });
                
                showMessage('Live prices updated!');
                
            } catch (error) {
                showMessage('Could not load live prices. Using default prices.', 'error');
            }
        }

        function calculatePotion() {
            const potionType = document.getElementById('potionType').value;
            const useLivePrices = document.getElementById('useLivePrices').checked;
            
            if (!potionType) {
                showMessage('Please select a potion type', 'error');
                return;
            }
            
            if (!playerData) {
                showMessage('Please load player stats first', 'error');
                return;
            }
            
            const potion = potionData[potionType];
            
            if (playerData.currentLevel < potion.level) {
                showMessage(`You need level ${potion.level} to make ${potion.name}`, 'error');
                return;
            }
            
            if (playerData.xpNeeded <= 0) {
                showMessage('You have already reached your target level!', 'error');
                return;
            }
            
            // Calculate how many potions needed
            const potionsNeeded = Math.ceil(playerData.xpNeeded / potion.xp);
            
            // Calculate costs
            const grimyHerbCost = currentPrices[potion.herb] * potionsNeeded;
            const secondaryCost = currentPrices[potion.secondary] * potionsNeeded;
            const vialCost = currentPrices.vial_of_water * potionsNeeded;
            
            // Calculate cleaning XP (2.5 XP per herb)
            const cleaningXP = potionsNeeded * 2.5;
            
            // Total costs
            const totalCost = grimyHerbCost + secondaryCost + vialCost;
            
            // Calculate selling price of finished potions
            const finishedPotionPrice = currentPrices[potionType + '_potion'] || 0;
            const totalRevenue = finishedPotionPrice * potionsNeeded;
            
            // Calculate profit/loss
            const profitLoss = totalRevenue - totalCost;
            
            // Display results
            displayResults({
                potionName: potion.name,
                potionsNeeded: potionsNeeded,
                grimyHerbCost: grimyHerbCost,
                secondaryCost: secondaryCost,
                vialCost: vialCost,
                totalCost: totalCost,
                cleaningXP: cleaningXP,
                potionXP: potionsNeeded * potion.xp,
                totalXP: cleaningXP + (potionsNeeded * potion.xp),
                totalRevenue: totalRevenue,
                profitLoss: profitLoss,
                herbName: potion.herb,
                secondaryName: potion.secondary
            });
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            const profitClass = results.profitLoss >= 0 ? 'profit' : 'loss';
            const profitText = results.profitLoss >= 0 ? 'Profit' : 'Loss';
            
            contentDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${results.potionsNeeded.toLocaleString()}</div>
                        <div class="stat-label">Potions Needed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${results.totalXP.toLocaleString()}</div>
                        <div class="stat-label">Total XP Gained</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${results.totalCost.toLocaleString()}</div>
                        <div class="stat-label">Total Cost (GP)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value ${profitClass}">${Math.abs(results.profitLoss).toLocaleString()}</div>
                        <div class="stat-label">${profitText} (GP)</div>
                    </div>
                </div>
                
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total Cost</th>
                            <th>XP Gained</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Grimy ${results.herbName.replace('_', ' ')}</td>
                            <td>${results.potionsNeeded.toLocaleString()}</td>
                            <td>${currentPrices[results.herbName].toLocaleString()} GP</td>
                            <td>${results.grimyHerbCost.toLocaleString()} GP</td>
                            <td>${results.cleaningXP.toLocaleString()} (cleaning)</td>
                        </tr>
                        <tr>
                            <td>${results.secondaryName.replace('_', ' ')}</td>
                            <td>${results.potionsNeeded.toLocaleString()}</td>
                            <td>${currentPrices[results.secondaryName].toLocaleString()} GP</td>
                            <td>${results.secondaryCost.toLocaleString()} GP</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Vial of Water</td>
                            <td>${results.potionsNeeded.toLocaleString()}</td>
                            <td>${currentPrices.vial_of_water.toLocaleString()} GP</td>
                            <td>${results.vialCost.toLocaleString()} GP</td>
                            <td>-</td>
                        </tr>
                        <tr style="background-color: #f0f8ff;">
                            <td><strong>${results.potionName} (3-dose)</strong></td>
                            <td><strong>${results.potionsNeeded.toLocaleString()}</strong></td>
                            <td><strong>${(currentPrices[document.getElementById('potionType').value + '_potion'] || 0).toLocaleString()} GP</strong></td>
                            <td><strong>${results.potionXP.toLocaleString()} XP</strong></td>
                            <td><strong>${results.potionXP.toLocaleString()} (making)</strong></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h3>Summary</h3
